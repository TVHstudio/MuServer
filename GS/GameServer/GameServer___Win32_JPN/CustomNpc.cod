; Listing generated by Microsoft (R) Optimizing Compiler Version 16.00.30319.01 

	TITLE	E:\work\tranet_version\GS\GameServer\CustomNpc.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?gCustomNpc@@3VcCustomNpc@@A			; gCustomNpc
_BSS	SEGMENT
?gCustomNpc@@3VcCustomNpc@@A DB 0198H DUP (?)		; gCustomNpc
_BSS	ENDS
PUBLIC	??_H@YGXPAXIHP6EPAX0@Z@Z			; `vector constructor iterator'
; Function compile flags: /Ogtp
;	COMDAT ??_H@YGXPAXIHP6EPAX0@Z@Z
_TEXT	SEGMENT
___t$ = 8						; size = 4
___s$ = 12						; size = 4
___n$ = 16						; size = 4
___f$ = 20						; size = 4
??_H@YGXPAXIHP6EPAX0@Z@Z PROC				; `vector constructor iterator', COMDAT
  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	57		 push	 edi
  00004	8b 7d 10	 mov	 edi, DWORD PTR ___n$[ebp]
  00007	4f		 dec	 edi
  00008	78 14		 js	 SHORT $LN1@vector
  0000a	53		 push	 ebx
  0000b	8b 5d 14	 mov	 ebx, DWORD PTR ___f$[ebp]
  0000e	56		 push	 esi
  0000f	8b 75 08	 mov	 esi, DWORD PTR ___t$[ebp]
$LL2@vector:
  00012	8b ce		 mov	 ecx, esi
  00014	ff d3		 call	 ebx
  00016	03 75 0c	 add	 esi, DWORD PTR ___s$[ebp]
  00019	4f		 dec	 edi
  0001a	79 f6		 jns	 SHORT $LL2@vector
  0001c	5e		 pop	 esi
  0001d	5b		 pop	 ebx
$LN1@vector:
  0001e	5f		 pop	 edi
  0001f	5d		 pop	 ebp
  00020	c2 10 00	 ret	 16			; 00000010H
??_H@YGXPAXIHP6EPAX0@Z@Z ENDP				; `vector constructor iterator'
_TEXT	ENDS
PUBLIC	??_C@_02DPKJAMEF@?$CFd?$AA@			; `string'
PUBLIC	??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@	; `string'
PUBLIC	??_C@_01KDCPPGHE@r?$AA@				; `string'
PUBLIC	??_C@_06POMJKEPM@Common?$AA@			; `string'
PUBLIC	??_C@_06CKGENIKG@Enable?$AA@			; `string'
PUBLIC	??_C@_0BN@GKKOENDP@?4?4?2Data?2ZtData?2CustomNpc?4ini?$AA@ ; `string'
PUBLIC	__$ArrayPad$
PUBLIC	?Load@cCustomNpc@@QAEXXZ			; cCustomNpc::Load
EXTRN	_fclose:PROC
EXTRN	_sscanf:PROC
EXTRN	?Zt_IsBadFileLine@@YA_NPADAAH@Z:PROC		; Zt_IsBadFileLine
EXTRN	_fgets:PROC
EXTRN	_feof:PROC
EXTRN	__imp__MessageBoxA@16:PROC
EXTRN	_fopen:PROC
EXTRN	__imp__GetPrivateProfileIntA@16:PROC
EXTRN	___security_cookie:DWORD
EXTRN	@__security_check_cookie@4:PROC
;	COMDAT ??_C@_02DPKJAMEF@?$CFd?$AA@
; File e:\work\tranet_version\gs\gameserver\customnpc.cpp
CONST	SEGMENT
??_C@_02DPKJAMEF@?$CFd?$AA@ DB '%d', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@
CONST	SEGMENT
??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@ DB 'LOAD FILE ERROR', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_01KDCPPGHE@r?$AA@
CONST	SEGMENT
??_C@_01KDCPPGHE@r?$AA@ DB 'r', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_06POMJKEPM@Common?$AA@
CONST	SEGMENT
??_C@_06POMJKEPM@Common?$AA@ DB 'Common', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_06CKGENIKG@Enable?$AA@
CONST	SEGMENT
??_C@_06CKGENIKG@Enable?$AA@ DB 'Enable', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0BN@GKKOENDP@?4?4?2Data?2ZtData?2CustomNpc?4ini?$AA@
CONST	SEGMENT
??_C@_0BN@GKKOENDP@?4?4?2Data?2ZtData?2CustomNpc?4ini?$AA@ DB '..\Data\Zt'
	DB	'Data\CustomNpc.ini', 00H			; `string'
; Function compile flags: /Ogtp
CONST	ENDS
;	COMDAT ?Load@cCustomNpc@@QAEXXZ
_TEXT	SEGMENT
_n$202118 = -268					; size = 4
_Flag$ = -264						; size = 4
_Buff$ = -260						; size = 256
__$ArrayPad$ = -4					; size = 4
?Load@cCustomNpc@@QAEXXZ PROC				; cCustomNpc::Load, COMDAT
; _this$ = ecx

; 9    : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	81 ec 0c 01 00
	00		 sub	 esp, 268		; 0000010cH
  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  0000e	33 c5		 xor	 eax, ebp
  00010	89 45 fc	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
  00013	53		 push	 ebx
  00014	56		 push	 esi
  00015	57		 push	 edi

; 10   : 	this->Enable = GetPrivateProfileInt("Common","Enable",0,CUSTOM_NPC_DIR);

  00016	68 00 00 00 00	 push	 OFFSET ??_C@_0BN@GKKOENDP@?4?4?2Data?2ZtData?2CustomNpc?4ini?$AA@
  0001b	33 ff		 xor	 edi, edi
  0001d	57		 push	 edi
  0001e	68 00 00 00 00	 push	 OFFSET ??_C@_06CKGENIKG@Enable?$AA@
  00023	68 00 00 00 00	 push	 OFFSET ??_C@_06POMJKEPM@Common?$AA@
  00028	8b f1		 mov	 esi, ecx
  0002a	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetPrivateProfileIntA@16

; 11   : 	
; 12   : 	FILE * file = fopen(CUSTOM_NPC_DIR,"r");

  00030	68 00 00 00 00	 push	 OFFSET ??_C@_01KDCPPGHE@r?$AA@
  00035	68 00 00 00 00	 push	 OFFSET ??_C@_0BN@GKKOENDP@?4?4?2Data?2ZtData?2CustomNpc?4ini?$AA@
  0003a	89 06		 mov	 DWORD PTR [esi], eax
  0003c	e8 00 00 00 00	 call	 _fopen
  00041	8b d8		 mov	 ebx, eax
  00043	83 c4 08	 add	 esp, 8

; 13   : 	if(file == NULL)

  00046	3b df		 cmp	 ebx, edi
  00048	75 14		 jne	 SHORT $LN9@Load

; 14   : 	{
; 15   : 		MessageBoxA(0,CUSTOM_NPC_DIR,"LOAD FILE ERROR",0);

  0004a	57		 push	 edi
  0004b	68 00 00 00 00	 push	 OFFSET ??_C@_0BA@PIOFNAIM@LOAD?5FILE?5ERROR?$AA@
  00050	68 00 00 00 00	 push	 OFFSET ??_C@_0BN@GKKOENDP@?4?4?2Data?2ZtData?2CustomNpc?4ini?$AA@
  00055	57		 push	 edi
  00056	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__MessageBoxA@16

; 16   : 		this->Enable = false;

  0005c	89 3e		 mov	 DWORD PTR [esi], edi
$LN9@Load:

; 17   : 	}
; 18   : 
; 19   : 	char Buff[256];
; 20   : 	int Flag = 0;

  0005e	89 bd f8 fe ff
	ff		 mov	 DWORD PTR _Flag$[ebp], edi

; 21   : 	this->CountNpc = 0;

  00064	89 be 94 01 00
	00		 mov	 DWORD PTR [esi+404], edi

; 22   : 	for (int i = 0; i < MAX_CUSTOM_NPC; i++)
; 23   : 	{
; 24   : 		this->NpcList[i] = 0;

  0006a	33 c0		 xor	 eax, eax
  0006c	8d 7e 04	 lea	 edi, DWORD PTR [esi+4]
  0006f	b9 64 00 00 00	 mov	 ecx, 100		; 00000064H

; 25   : 	}
; 26   : 	while(!feof(file))

  00074	53		 push	 ebx
  00075	f3 ab		 rep stosd
  00077	e8 00 00 00 00	 call	 _feof
  0007c	83 c4 04	 add	 esp, 4
  0007f	85 c0		 test	 eax, eax
  00081	0f 85 84 00 00
	00		 jne	 $LN15@Load
  00087	8d 78 01	 lea	 edi, DWORD PTR [eax+1]
  0008a	8d 9b 00 00 00
	00		 npad	 6
$LL5@Load:

; 27   : 	{
; 28   : 		fgets(Buff,256,file);

  00090	53		 push	 ebx
  00091	8d 85 fc fe ff
	ff		 lea	 eax, DWORD PTR _Buff$[ebp]
  00097	68 00 01 00 00	 push	 256			; 00000100H
  0009c	50		 push	 eax
  0009d	e8 00 00 00 00	 call	 _fgets

; 29   : 		if(Zt_IsBadFileLine(Buff, Flag))

  000a2	8d 8d f8 fe ff
	ff		 lea	 ecx, DWORD PTR _Flag$[ebp]
  000a8	51		 push	 ecx
  000a9	8d 95 fc fe ff
	ff		 lea	 edx, DWORD PTR _Buff$[ebp]
  000af	52		 push	 edx
  000b0	e8 00 00 00 00	 call	 ?Zt_IsBadFileLine@@YA_NPADAAH@Z ; Zt_IsBadFileLine
  000b5	83 c4 14	 add	 esp, 20			; 00000014H
  000b8	84 c0		 test	 al, al
  000ba	75 42		 jne	 SHORT $LN2@Load

; 30   : 			continue;
; 31   : 		if(Flag == 1)

  000bc	39 bd f8 fe ff
	ff		 cmp	 DWORD PTR _Flag$[ebp], edi
  000c2	75 3a		 jne	 SHORT $LN2@Load

; 32   : 		{
; 33   : 			if(this->CountNpc == MAX_CUSTOM_NPC) break;

  000c4	83 be 94 01 00
	00 64		 cmp	 DWORD PTR [esi+404], 100 ; 00000064H
  000cb	74 3e		 je	 SHORT $LN15@Load

; 34   : 			int n[1];
; 35   : 			sscanf(Buff, "%d", &n[0]);

  000cd	8d 85 f4 fe ff
	ff		 lea	 eax, DWORD PTR _n$202118[ebp]
  000d3	50		 push	 eax
  000d4	8d 8d fc fe ff
	ff		 lea	 ecx, DWORD PTR _Buff$[ebp]
  000da	68 00 00 00 00	 push	 OFFSET ??_C@_02DPKJAMEF@?$CFd?$AA@
  000df	51		 push	 ecx
  000e0	e8 00 00 00 00	 call	 _sscanf

; 36   : 			this->NpcList[this->CountNpc] = n[0];

  000e5	8b 96 94 01 00
	00		 mov	 edx, DWORD PTR [esi+404]
  000eb	8b 85 f4 fe ff
	ff		 mov	 eax, DWORD PTR _n$202118[ebp]
  000f1	83 c4 0c	 add	 esp, 12			; 0000000cH
  000f4	89 44 96 04	 mov	 DWORD PTR [esi+edx*4+4], eax

; 37   : 			this->CountNpc++;

  000f8	01 be 94 01 00
	00		 add	 DWORD PTR [esi+404], edi
$LN2@Load:

; 25   : 	}
; 26   : 	while(!feof(file))

  000fe	53		 push	 ebx
  000ff	e8 00 00 00 00	 call	 _feof
  00104	83 c4 04	 add	 esp, 4
  00107	85 c0		 test	 eax, eax
  00109	74 85		 je	 SHORT $LL5@Load
$LN15@Load:

; 38   : 		}
; 39   : 	}
; 40   : 	fclose(file);

  0010b	53		 push	 ebx
  0010c	e8 00 00 00 00	 call	 _fclose

; 41   : }

  00111	8b 4d fc	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  00114	83 c4 04	 add	 esp, 4
  00117	5f		 pop	 edi
  00118	5e		 pop	 esi
  00119	33 cd		 xor	 ecx, ebp
  0011b	5b		 pop	 ebx
  0011c	e8 00 00 00 00	 call	 @__security_check_cookie@4
  00121	8b e5		 mov	 esp, ebp
  00123	5d		 pop	 ebp
  00124	c3		 ret	 0
?Load@cCustomNpc@@QAEXXZ ENDP				; cCustomNpc::Load
_TEXT	ENDS
PUBLIC	?Main@cCustomNpc@@QAEXHH@Z			; cCustomNpc::Main
EXTRN	?gObj@@3PAUOBJECTSTRUCT@@A:DWORD		; gObj
; Function compile flags: /Ogtp
;	COMDAT ?Main@cCustomNpc@@QAEXHH@Z
_TEXT	SEGMENT
_aIndex$ = 8						; size = 4
_MonsterClass$ = 12					; size = 4
?Main@cCustomNpc@@QAEXHH@Z PROC				; cCustomNpc::Main, COMDAT
; _this$ = ecx

; 44   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 45   : 	if(!this->Enable)return;

  00003	83 39 00	 cmp	 DWORD PTR [ecx], 0
  00006	74 44		 je	 SHORT $LN2@Main

; 46   :  	LPOBJ lpObj = &gObj[aIndex];

  00008	8b 55 08	 mov	 edx, DWORD PTR _aIndex$[ebp]
  0000b	69 d2 50 2b 00
	00		 imul	 edx, 11088		; 00002b50H
  00011	03 15 00 00 00
	00		 add	 edx, DWORD PTR ?gObj@@3PAUOBJECTSTRUCT@@A ; gObj

; 47   : 	for (int i = 0; i < this->CountNpc; i++)

  00017	33 c0		 xor	 eax, eax
  00019	39 81 94 01 00
	00		 cmp	 DWORD PTR [ecx+404], eax
  0001f	7e 2b		 jle	 SHORT $LN2@Main

; 46   :  	LPOBJ lpObj = &gObj[aIndex];

  00021	53		 push	 ebx
  00022	56		 push	 esi
  00023	57		 push	 edi
  00024	8b 7d 0c	 mov	 edi, DWORD PTR _MonsterClass$[ebp]
  00027	8d 71 04	 lea	 esi, DWORD PTR [ecx+4]
  0002a	8d 9b 00 00 00
	00		 npad	 6
$LL4@Main:

; 48   : 		if(MonsterClass == NpcList[i])

  00030	3b 3e		 cmp	 edi, DWORD PTR [esi]
  00032	75 09		 jne	 SHORT $LN3@Main

; 49   : 			lpObj->Type = OBJ_NPC;

  00034	bb 03 00 00 00	 mov	 ebx, 3
  00039	66 89 5a 68	 mov	 WORD PTR [edx+104], bx
$LN3@Main:

; 47   : 	for (int i = 0; i < this->CountNpc; i++)

  0003d	40		 inc	 eax
  0003e	83 c6 04	 add	 esi, 4
  00041	3b 81 94 01 00
	00		 cmp	 eax, DWORD PTR [ecx+404]
  00047	7c e7		 jl	 SHORT $LL4@Main
  00049	5f		 pop	 edi
  0004a	5e		 pop	 esi
  0004b	5b		 pop	 ebx
$LN2@Main:

; 50   : }

  0004c	5d		 pop	 ebp
  0004d	c2 08 00	 ret	 8
?Main@cCustomNpc@@QAEXHH@Z ENDP				; cCustomNpc::Main
_TEXT	ENDS
END
