; Listing generated by Microsoft (R) Optimizing Compiler Version 16.00.30319.01 

	TITLE	E:\work\tranet_version\GS\GameServer\PlayerConnect.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	??_H@YGXPAXIHP6EPAX0@Z@Z			; `vector constructor iterator'
; Function compile flags: /Ogtp
;	COMDAT ??_H@YGXPAXIHP6EPAX0@Z@Z
_TEXT	SEGMENT
___t$ = 8						; size = 4
___s$ = 12						; size = 4
___n$ = 16						; size = 4
___f$ = 20						; size = 4
??_H@YGXPAXIHP6EPAX0@Z@Z PROC				; `vector constructor iterator', COMDAT
  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	57		 push	 edi
  00004	8b 7d 10	 mov	 edi, DWORD PTR ___n$[ebp]
  00007	4f		 dec	 edi
  00008	78 14		 js	 SHORT $LN1@vector
  0000a	53		 push	 ebx
  0000b	8b 5d 14	 mov	 ebx, DWORD PTR ___f$[ebp]
  0000e	56		 push	 esi
  0000f	8b 75 08	 mov	 esi, DWORD PTR ___t$[ebp]
$LL2@vector:
  00012	8b ce		 mov	 ecx, esi
  00014	ff d3		 call	 ebx
  00016	03 75 0c	 add	 esi, DWORD PTR ___s$[ebp]
  00019	4f		 dec	 edi
  0001a	79 f6		 jns	 SHORT $LL2@vector
  0001c	5e		 pop	 esi
  0001d	5b		 pop	 ebx
$LN1@vector:
  0001e	5f		 pop	 edi
  0001f	5d		 pop	 ebp
  00020	c2 10 00	 ret	 16			; 00000010H
??_H@YGXPAXIHP6EPAX0@Z@Z ENDP				; `vector constructor iterator'
_TEXT	ENDS
PUBLIC	??_C@_0M@HEPEADLP@?$FL?$CFs?$FN?3Online?$AA@	; `string'
PUBLIC	??_C@_08IJKOBABM@?$FLSystem?$FN?$AA@		; `string'
PUBLIC	??_C@_09EFMLPCOM@?$CFs?5Online?$AA@		; `string'
PUBLIC	?ExPlayerConnectSystem@@YAXH@Z			; ExPlayerConnectSystem
EXTRN	?MsgNormal@@YAXHPADZZ:PROC			; MsgNormal
EXTRN	?GetText@CZtText@@QAEPADH@Z:PROC		; CZtText::GetText
EXTRN	?g_ZtText@@3VCZtText@@A:BYTE			; g_ZtText
EXTRN	?getShowOnline@@YAHXZ:PROC			; getShowOnline
EXTRN	?MessaageAllGlobal@@YAXPADZZ:PROC		; MessaageAllGlobal
EXTRN	?CheckAuthorityCondition@@YA_NHPAUOBJECTSTRUCT@@@Z:PROC ; CheckAuthorityCondition
EXTRN	?MessageSendAllEx@@YAXHPAD0ZZ:PROC		; MessageSendAllEx
EXTRN	?ZtConfig@@3VcZtConfigs@@A:BYTE			; ZtConfig
EXTRN	?CheckUser@CZtLicense@@QAE_NH@Z:PROC		; CZtLicense::CheckUser
EXTRN	?g_ZtLicense@@3VCZtLicense@@A:BYTE		; g_ZtLicense
EXTRN	?gObj@@3PAUOBJECTSTRUCT@@A:DWORD		; gObj
;	COMDAT ??_C@_0M@HEPEADLP@?$FL?$CFs?$FN?3Online?$AA@
; File e:\work\tranet_version\gs\gameserver\playerconnect.cpp
CONST	SEGMENT
??_C@_0M@HEPEADLP@?$FL?$CFs?$FN?3Online?$AA@ DB '[%s]:Online', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_08IJKOBABM@?$FLSystem?$FN?$AA@
CONST	SEGMENT
??_C@_08IJKOBABM@?$FLSystem?$FN?$AA@ DB '[System]', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_09EFMLPCOM@?$CFs?5Online?$AA@
CONST	SEGMENT
??_C@_09EFMLPCOM@?$CFs?5Online?$AA@ DB '%s Online', 00H	; `string'
; Function compile flags: /Ogtp
CONST	ENDS
;	COMDAT ?ExPlayerConnectSystem@@YAXH@Z
_TEXT	SEGMENT
_aIndex$ = 8						; size = 4
?ExPlayerConnectSystem@@YAXH@Z PROC			; ExPlayerConnectSystem, COMDAT

; 15   : {	

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	56		 push	 esi
  00004	57		 push	 edi

; 16   : 	LPOBJ lpObj = &gObj[aIndex];

  00005	8b 7d 08	 mov	 edi, DWORD PTR _aIndex$[ebp]
  00008	8b f7		 mov	 esi, edi
  0000a	69 f6 50 2b 00
	00		 imul	 esi, 11088		; 00002b50H
  00010	03 35 00 00 00
	00		 add	 esi, DWORD PTR ?gObj@@3PAUOBJECTSTRUCT@@A ; gObj

; 17   : 	if(lpObj->MapNumber == 10){
; 18   : 	
; 19   : 	}
; 20   : 
; 21   : #ifdef TWO_IP_CONNECT_OFF
; 22   : 	if(g_ZtLicense.CheckUser(eZtUB::ulasevich) || g_ZtLicense.CheckUser(eZtUB::Local) || g_ZtLicense.CheckUser(eZtUB::ulasevich2))
; 23   : 	{
; 24   : 		int CountIpAddress;
; 25   : 		CountIpAddress = 0;
; 26   : 		for ( int n = OBJ_STARTUSERINDZT ; n < OBJMAX ; n++)
; 27   : 		{
; 28   : 				if ( gObj[n].Type == OBJ_USER && gObj[n].Connected == PLAYER_PLAYING )
; 29   : 				{
; 30   : 					if (lpObj->m_Index == gObj[n].m_Index)
; 31   : 					{
; 32   : 						continue;
; 33   : 					}
; 34   : 						if(!strcmp(lpObj->Ip_addr, gObj[n].Ip_addr))
; 35   : 						{
; 36   : 							CountIpAddress++;
; 37   : 								
; 38   : 						}
; 39   : 						
; 40   : 				}
; 41   : 		}
; 42   : 		if(CountIpAddress >= 2)
; 43   : 		{
; 44   : 			g_ConnectZt.SendClose(aIndex, NORM_DC);
; 45   : 			return;
; 46   : 		}
; 47   : 			
; 48   : 	}
; 49   : #endif
; 50   : 
; 51   : 	if(g_ZtLicense.CheckUser(eZtUB::ulasevich) || g_ZtLicense.CheckUser(eZtUB::Local3) || g_ZtLicense.CheckUser(eZtUB::ulasevich2))

  00016	6a 17		 push	 23			; 00000017H
  00018	b9 00 00 00 00	 mov	 ecx, OFFSET ?g_ZtLicense@@3VCZtLicense@@A ; g_ZtLicense
  0001d	e8 00 00 00 00	 call	 ?CheckUser@CZtLicense@@QAE_NH@Z ; CZtLicense::CheckUser
  00022	84 c0		 test	 al, al
  00024	75 20		 jne	 SHORT $LN8@ExPlayerCo
  00026	6a 1c		 push	 28			; 0000001cH
  00028	b9 00 00 00 00	 mov	 ecx, OFFSET ?g_ZtLicense@@3VCZtLicense@@A ; g_ZtLicense
  0002d	e8 00 00 00 00	 call	 ?CheckUser@CZtLicense@@QAE_NH@Z ; CZtLicense::CheckUser
  00032	84 c0		 test	 al, al
  00034	75 10		 jne	 SHORT $LN8@ExPlayerCo
  00036	6a 24		 push	 36			; 00000024H
  00038	b9 00 00 00 00	 mov	 ecx, OFFSET ?g_ZtLicense@@3VCZtLicense@@A ; g_ZtLicense
  0003d	e8 00 00 00 00	 call	 ?CheckUser@CZtLicense@@QAE_NH@Z ; CZtLicense::CheckUser
  00042	84 c0		 test	 al, al
  00044	74 4f		 je	 SHORT $LN5@ExPlayerCo
$LN8@ExPlayerCo:

; 52   : 	{
; 53   : 		if(ZtConfig.PlayerConnect.ShowNameAll == 1)

  00046	83 3d 50 0a 00
	00 01		 cmp	 DWORD PTR ?ZtConfig@@3VcZtConfigs@@A+2640, 1
  0004d	75 1d		 jne	 SHORT $LN7@ExPlayerCo

; 54   : 		{
; 55   : 			MessageSendAllEx(ZtConfig.PlayerConnect.ShowNameColor,"[System]", "%s Online" , lpObj->Name);

  0004f	8b 0d 54 0a 00
	00		 mov	 ecx, DWORD PTR ?ZtConfig@@3VcZtConfigs@@A+2644
  00055	8d 46 77	 lea	 eax, DWORD PTR [esi+119]
  00058	50		 push	 eax
  00059	68 00 00 00 00	 push	 OFFSET ??_C@_09EFMLPCOM@?$CFs?5Online?$AA@
  0005e	68 00 00 00 00	 push	 OFFSET ??_C@_08IJKOBABM@?$FLSystem?$FN?$AA@
  00063	51		 push	 ecx
  00064	e8 00 00 00 00	 call	 ?MessageSendAllEx@@YAXHPAD0ZZ ; MessageSendAllEx
  00069	83 c4 10	 add	 esp, 16			; 00000010H
$LN7@ExPlayerCo:

; 56   : 		}
; 57   : 		if ( CheckAuthorityCondition(98, lpObj) == true) //season4 changed

  0006c	56		 push	 esi
  0006d	6a 62		 push	 98			; 00000062H
  0006f	e8 00 00 00 00	 call	 ?CheckAuthorityCondition@@YA_NHPAUOBJECTSTRUCT@@@Z ; CheckAuthorityCondition
  00074	83 c4 08	 add	 esp, 8
  00077	3c 01		 cmp	 al, 1
  00079	75 1a		 jne	 SHORT $LN5@ExPlayerCo

; 58   : 		{
; 59   : 			if(ZtConfig.PlayerConnect.ShowGMAll == 1)

  0007b	83 3d 58 0a 00
	00 01		 cmp	 DWORD PTR ?ZtConfig@@3VcZtConfigs@@A+2648, 1
  00082	75 11		 jne	 SHORT $LN5@ExPlayerCo

; 60   : 			{
; 61   : 				MessaageAllGlobal("[%s]:Online", lpObj->Name);

  00084	8d 56 77	 lea	 edx, DWORD PTR [esi+119]
  00087	52		 push	 edx
  00088	68 00 00 00 00	 push	 OFFSET ??_C@_0M@HEPEADLP@?$FL?$CFs?$FN?3Online?$AA@
  0008d	e8 00 00 00 00	 call	 ?MessaageAllGlobal@@YAXPADZZ ; MessaageAllGlobal
  00092	83 c4 08	 add	 esp, 8
$LN5@ExPlayerCo:

; 62   : 			}
; 63   : 		}
; 64   : 	}
; 65   : 	if(!ZtConfig.PlayerConnect.EnablePlayerConnectSystem)

  00095	83 3d 40 0a 00
	00 00		 cmp	 DWORD PTR ?ZtConfig@@3VcZtConfigs@@A+2624, 0
  0009c	74 71		 je	 SHORT $LN1@ExPlayerCo

; 66   : 		return;
; 67   : 
; 68   : #ifdef _UPDATE8_
; 69   : 	if(ZtConfig.PlayerConnect.ShowOnline)	MsgNormal(aIndex, g_ZtText.GetText(2), getShowOnline());

  0009e	83 3d 4c 0a 00
	00 00		 cmp	 DWORD PTR ?ZtConfig@@3VcZtConfigs@@A+2636, 0
  000a5	74 1c		 je	 SHORT $LN3@ExPlayerCo
  000a7	e8 00 00 00 00	 call	 ?getShowOnline@@YAHXZ	; getShowOnline
  000ac	50		 push	 eax
  000ad	6a 02		 push	 2
  000af	b9 00 00 00 00	 mov	 ecx, OFFSET ?g_ZtText@@3VCZtText@@A ; g_ZtText
  000b4	e8 00 00 00 00	 call	 ?GetText@CZtText@@QAEPADH@Z ; CZtText::GetText
  000b9	50		 push	 eax
  000ba	57		 push	 edi
  000bb	e8 00 00 00 00	 call	 ?MsgNormal@@YAXHPADZZ	; MsgNormal
  000c0	83 c4 0c	 add	 esp, 12			; 0000000cH
$LN3@ExPlayerCo:

; 70   : #endif
; 71   : 	if(ZtConfig.PlayerConnect.ShowReset) MsgNormal(aIndex, g_ZtText.GetText(0), lpObj->Reset);

  000c3	83 3d 44 0a 00
	00 00		 cmp	 DWORD PTR ?ZtConfig@@3VcZtConfigs@@A+2628, 0
  000ca	74 1d		 je	 SHORT $LN2@ExPlayerCo
  000cc	8b 86 90 22 00
	00		 mov	 eax, DWORD PTR [esi+8848]
  000d2	50		 push	 eax
  000d3	6a 00		 push	 0
  000d5	b9 00 00 00 00	 mov	 ecx, OFFSET ?g_ZtText@@3VCZtText@@A ; g_ZtText
  000da	e8 00 00 00 00	 call	 ?GetText@CZtText@@QAEPADH@Z ; CZtText::GetText
  000df	50		 push	 eax
  000e0	57		 push	 edi
  000e1	e8 00 00 00 00	 call	 ?MsgNormal@@YAXHPADZZ	; MsgNormal
  000e6	83 c4 0c	 add	 esp, 12			; 0000000cH
$LN2@ExPlayerCo:

; 72   : 	if(ZtConfig.PlayerConnect.ShowGReset) MsgNormal(aIndex, g_ZtText.GetText(1), lpObj->GReset);

  000e9	83 3d 48 0a 00
	00 00		 cmp	 DWORD PTR ?ZtConfig@@3VcZtConfigs@@A+2632, 0
  000f0	74 1d		 je	 SHORT $LN1@ExPlayerCo
  000f2	8b 8e 94 22 00
	00		 mov	 ecx, DWORD PTR [esi+8852]
  000f8	51		 push	 ecx
  000f9	6a 01		 push	 1
  000fb	b9 00 00 00 00	 mov	 ecx, OFFSET ?g_ZtText@@3VCZtText@@A ; g_ZtText
  00100	e8 00 00 00 00	 call	 ?GetText@CZtText@@QAEPADH@Z ; CZtText::GetText
  00105	50		 push	 eax
  00106	57		 push	 edi
  00107	e8 00 00 00 00	 call	 ?MsgNormal@@YAXHPADZZ	; MsgNormal
  0010c	83 c4 0c	 add	 esp, 12			; 0000000cH
$LN1@ExPlayerCo:
  0010f	5f		 pop	 edi
  00110	5e		 pop	 esi

; 73   : }

  00111	5d		 pop	 ebp
  00112	c3		 ret	 0
?ExPlayerConnectSystem@@YAXH@Z ENDP			; ExPlayerConnectSystem
_TEXT	ENDS
END
